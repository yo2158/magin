# MAGINの判定ロジック

**3つのAI判定からどのように判断を下すのか？**

MAGINは、Claude・Gemini・ChatGPTの3つのAIに同時に意見を聞き、その結果を集約して最終判定を行います。このドキュメントでは、MAGINがどのように判断を下すのか、その仕組みを解説します。

---

## 📊 判定の全体フロー

![判定フロー図](../img/judgment-flow.png)

---

## 🎯 4観点スコアリング（4-ASPECT SCORES）

各AIは、議題を以下の4つの観点から0.0〜1.0でスコアリングします。

### 1. VALIDITY（妥当性）
**提案内容が目的に対して整合しているか**

- **1.0**: 完全に整合している
- **0.5**: 部分的に整合している
- **0.0**: 全く整合していない

### 2. FEASIBILITY（実現可能性）
**実行するためのリソース・条件が揃っているか**

- **1.0**: 完全に実行可能
- **0.5**: 条件付きで可能
- **0.0**: 実行不可能

### 3. RISK（リスク）
**安全性・倫理・コストの観点でリスクが低いか**

- **1.0**: リスクが極めて低い
- **0.5**: 中程度のリスク
- **0.0**: 重大なリスク

### 4. CERTAINTY（情報確実性）
**判断の根拠や前提が明確か**

- **1.0**: 根拠が明確で確実
- **0.5**: やや不確実
- **0.0**: 根拠不明

---

## 📈 各AIの判定（DECISION）

4観点の平均スコアから、各AIは以下のルールで判定を下します。

| 平均スコア | 判定 | 意味 |
|-----------|------|------|
| **0.9以上** | 承認 | 全観点で高評価（※ただしリスク制約あり） |
| **0.7以上0.9未満** | 部分的承認 | おおよそ承認だが一部懸念あり |
| **0.7未満** | 否決 | 懸念が大きい |

### ⚠️ リスク下限制約（最優先）

**risk < 0.6** の場合、平均スコアが0.9以上でも「承認」を選択できません。

- この場合、最高でも「部分的承認」（平均 >= 0.7なら）または「否決」（平均 < 0.7なら）

---

## 🔢 SEVERITY SCORE（重大度）

各AIは、議題の重大度を0〜100のスコアで評価します。

| スコア範囲 | 意味 | 例 |
|-----------|------|---|
| **0-20** | 個人的 | チャットルーム名の変更 |
| **21-40** | 組織的 | 部署内の予算配分 |
| **41-60** | 社会的 | 地域のイベント開催 |
| **61-80** | 国家的 | 法律の改正 |
| **81-100** | 存亡級 | 国家安全保障に関わる決定 |

**重要**: 重大度は判定（承認/否決）とは別軸です。高重大度でも承認されることもあれば、低重大度でも否決されることもあります。

### 判定用重大度の算出

3つのAIの重大度スコアから、以下の計算で「判定用重大度」を算出します。

```
平均重大度 = (Claude重大度 + Gemini重大度 + ChatGPT重大度) / 3
最大重大度 = max(Claude重大度, Gemini重大度, ChatGPT重大度)

判定用重大度 = max(平均重大度, 最大重大度 × 0.8)
```

この「判定用重大度」を使って、最終判定のテーブルを選択します。

---

## 🚨 ハードフラグ（HARD FLAG）

AIが「致命的な懸念」を検出した場合、ハードフラグを立てます。

| フラグ | 意味 | 例 |
|-------|------|---|
| **compliance** | コンプライアンス違反 | 法令に明確に抵触 |
| **security** | セキュリティリスク | 重大なセキュリティ脆弱性 |
| **privacy** | プライバシー侵害 | 個人情報漏洩の懸念 |
| **none** | 懸念なし | 通常状態 |

### ハードフラグの最優先ルール

**1つでもハードフラグが検出された場合、重大度に関わらず即座に「否決」となります。**

これは、コンプライアンス・セキュリティ・プライバシーの問題は、重大度とは独立して致命的であるためです。

---

## ⚖️ 最終判定のロジック

### ステップ1: ハードフラグチェック

まず、3つのAIの応答をチェックし、1つでもハードフラグが立っていれば**即座に「否決」**。

### ステップ2: 合計点の計算

ハードフラグがない場合、各AIの判定を点数化して合計します。

| 判定 | 点数 |
|------|------|
| 承認 | 1.0点 |
| 部分的承認 | 0.5点 |
| 否決 | 0.0点 |

**例**: Claude「承認(1.0)」+ Gemini「承認(1.0)」+ ChatGPT「部分的承認(0.5)」 = **2.5点**

### ステップ3: 重大度別判定テーブル適用

「判定用重大度」に応じて、異なる判定テーブルを適用します。

#### 🔴 重大度高（判定用重大度 >= 80）

**全員一致が必要**

| 合計点 | 最終判定 | 説明 |
|--------|----------|------|
| **3.0** | 承認 | 全員一致で承認 |
| **2.5** | 条件付き承認 | 2承認 + 1部分的承認 |
| **2.0以下** | 否決 | 全員一致の要件を満たさない |

#### 🟡 重大度中（50 <= 判定用重大度 < 80）

**過半数の承認が必要**

| 合計点 | 最終判定 | 説明 |
|--------|----------|------|
| **2.0以上** | 承認 | 過半数が承認 |
| **1.0以上2.0未満** | 条件付き承認 | 1承認 + 部分的承認混在 |
| **1.0未満** | 否決 | 過半数の要件を満たさない |

#### 🟢 重大度低（判定用重大度 < 50）

**柔軟な判定**

| 合計点 | 最終判定 | 説明 |
|--------|----------|------|
| **2.0以上** | 承認 | 2名以上が承認 |
| **1.0以上2.0未満** | 条件付き承認 | 1名承認または部分的承認混在 |
| **1.0未満** | 否決 | 承認が不足 |

---

## 💡 具体例

### 例1: 重大度高 + ハードフラグなし

**議題**: 「新規サービスを即時全社展開する」

**AI応答**:

| AI | VALIDITY | FEASIBILITY | RISK | CERTAINTY | 平均 | DECISION | SEVERITY |
|----|----------|-------------|------|-----------|------|----------|----------|
| Claude | 0.9 | 0.8 | 0.7 | 0.8 | 0.80 | 部分的承認 | 85 |
| Gemini | 0.85 | 0.85 | 0.6 | 0.75 | 0.76 | 部分的承認 | 82 |
| ChatGPT | 0.8 | 0.9 | 0.65 | 0.85 | 0.80 | 部分的承認 | 88 |

**判定プロセス**:
1. ハードフラグ: なし
2. 判定用重大度: 85（高）
3. 合計点: 0.5 + 0.5 + 0.5 = **1.5点**
4. テーブル適用（重大度高）: 1.5 < 2.5 → **否決**

**最終判定**: **否決**（重大度85%で合計点1.5/3.0点。全員一致の要件を満たさないため否決）

---

### 例2: 重大度中 + ハードフラグあり

**議題**: 「個人情報を含むログファイルを外部サーバーに保存する」

**AI応答**:

| AI | VALIDITY | FEASIBILITY | RISK | CERTAINTY | 平均 | DECISION | SEVERITY | HARD FLAG |
|----|----------|-------------|------|-----------|------|----------|----------|-----------|
| Claude | 0.7 | 0.9 | 0.4 | 0.6 | 0.65 | 否決 | 65 | **privacy** |
| Gemini | 0.75 | 0.85 | 0.5 | 0.7 | 0.70 | 部分的承認 | 62 | none |
| ChatGPT | 0.8 | 0.9 | 0.45 | 0.65 | 0.70 | 部分的承認 | 68 | none |

**判定プロセス**:
1. **ハードフラグ検出**: Claudeが"privacy"を設定
2. **ハードフラグ最優先ルール適用** → 即座に**否決**

**最終判定**: **否決**（重大な懸念（privacy）があるため否決されました）

---

### 例3: 重大度低 + ハードフラグなし

**議題**: 「チーム内のSlackチャンネル名を変更する」

**AI応答**:

| AI | VALIDITY | FEASIBILITY | RISK | CERTAINTY | 平均 | DECISION | SEVERITY |
|----|----------|-------------|------|-----------|------|----------|----------|
| Claude | 0.95 | 1.0 | 0.95 | 0.9 | 0.95 | 承認 | 15 |
| Gemini | 0.9 | 1.0 | 0.9 | 0.85 | 0.91 | 承認 | 12 |
| ChatGPT | 0.85 | 0.95 | 0.85 | 0.8 | 0.86 | 部分的承認 | 18 |

**判定プロセス**:
1. ハードフラグ: なし
2. 判定用重大度: 15（低）
3. 合計点: 1.0 + 1.0 + 0.5 = **2.5点**
4. テーブル適用（重大度低）: 2.5 >= 2.0 → **承認**

**最終判定**: **承認**（重大度15%（低リスク）で合計点2.5/3.0点。承認されました）

---

## 🔍 判定ロジックのポイント

### 1. 多層的な判断

MAGINは単純な多数決ではなく、以下の要素を組み合わせて判定します。

- **4観点スコア**: 多角的な評価
- **ハードフラグ**: 致命的な懸念の検出
- **重大度**: 議題の影響範囲
- **合計点**: 3つのAIの総意

### 2. 安全性重視

- **リスク下限制約**: リスクが高い場合、平均スコアが高くても承認しない
- **ハードフラグ最優先**: コンプライアンス・セキュリティ・プライバシーの問題は即座に否決

### 3. 透明性

- 各AIの判断根拠（REASONING）を表示
- 4観点スコアで「なぜその判定になったか」を可視化
- 懸念点（CONCERNS）をリスト表示

---

## ⚠️ 注意事項

### AIの限界

- AIは自動生成された判断を提供しますが、**必ずしも正確ではありません**
- 最終的な意思決定は**必ず人間が行ってください**
- MAGINの判定結果は、あくまで**参考情報**としてご利用ください

### 判定の妥当性

- ハードフラグの検出精度は100%ではありません
- 重大度の評価は、AIの学習データや前提に依存します
- 複雑な議題では、AIの判断が分かれることがあります

---
